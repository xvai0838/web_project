import{_ as J,r as c,o as K,u as Q,c as n,b as e,d as p,h as T,v as B,F as X,e as ee,t as d,w as y,i as C,n as se,f as i}from"./index-D_xQVRzG.js";import{v as te,g as ae,a as le,u as oe,b as ne,d as ie}from"./userApi-_ZDq3u6c.js";const re={class:"user-profile-page"},ce={class:"profile-container"},ue={class:"user-info-section"},de={class:"avatar-section"},ve=["src"],me={key:1,class:"avatar-placeholder"},pe={class:"info-fields"},ge={class:"form-group"},he={class:"form-group"},fe={class:"history-section"},ye={key:0,class:"history-list"},_e=["onClick"],ke=["src"],be={class:"history-info"},we={class:"history-title"},Ce={class:"history-date"},Ie=["onClick"],De={key:1,class:"no-history"},$e=["disabled"],Me={class:"detail-content"},Re={class:"detail-date"},Se={class:"detail-images"},Ue=["src"],Ve=["src"],xe={key:0,class:"detail-analysis"},Ae={class:"image-viewer-content"},He={class:"viewer-controls"},ze=["disabled"],Le=["disabled"],Pe={class:"viewer-image-container"},Te=["src"],Be={__name:"UserProfilePage",setup(Fe){const m=Q(),I=c(null),D=c(!1),g=c(!1),r=c({nickname:"",avatar:"",email:""}),_=c([]),k=c(!1),a=c(null),b=c(!1),w=c(""),l=c(1),F=()=>{var t;(t=I.value)==null||t.click()},N=t=>{const s=t.target.files[0];if(s){const u=new FileReader;u.onload=v=>{r.value.avatar=v.target.result},u.readAsDataURL(s)}},W=t=>{a.value=t,k.value=!0},$=()=>{k.value=!1,a.value=null},M=t=>{w.value=t,l.value=1,b.value=!0},R=()=>{b.value=!1,w.value=""},S=()=>{l.value<3&&(l.value=Math.min(3,l.value+.25))},U=()=>{l.value>.5&&(l.value=Math.max(.5,l.value-.25))},E=()=>{l.value=1},G=t=>{t.deltaY<0?S():U()},O=()=>{m.push("/")},Y=async()=>{confirm("ç¡®å®šè¦åˆ‡æ¢è´¦å·å—ï¼Ÿå½“å‰è´¦å·å°†é€€å‡ºç™»å½•ã€‚")&&(await ne(),m.push("/login"))},V=t=>{const s=new Date(t),u=s.getMonth()+1,v=s.getDate(),h=s.getHours().toString().padStart(2,"0"),f=s.getMinutes().toString().padStart(2,"0");return`${u}æœˆ${v}æ—¥ ${h}:${f}`},Z=async t=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ"))try{await ie(t),await x()}catch(s){alert("åˆ é™¤å¤±è´¥: "+s.message)}},x=async()=>{try{const t=await le();_.value=t.sort((s,u)=>u.timestamp-s.timestamp)}catch(t){console.error("åŠ è½½å†å²è®°å½•å¤±è´¥:",t)}},j=async()=>{g.value=!0;try{await oe({nickname:r.value.nickname,avatar:r.value.avatar,email:r.value.email}),m.push("/app")}catch(t){alert("ä¿å­˜å¤±è´¥: "+t.message)}finally{g.value=!1}};return K(async()=>{D.value=!0;try{if(!(await te()).success){m.push("/login");return}const s=ae();s&&(r.value={nickname:s.nickname||"",avatar:s.avatar||"",email:s.email||""}),await x()}catch(t){console.error("åˆå§‹åŒ–å¤±è´¥:",t),m.push("/login")}finally{D.value=!1}}),(t,s)=>{var u,v,h,f,A,H,z;return i(),n("div",re,[s[12]||(s[12]=e("div",{class:"background-image"},null,-1)),e("button",{class:"back-home-btn",onClick:O}," â† è¿”å›é¦–é¡µ "),e("button",{class:"switch-account-btn",onClick:Y}," ğŸ”„ åˆ‡æ¢è´¦å· "),e("div",ce,[s[8]||(s[8]=e("h2",{class:"profile-title"},"ç”¨æˆ·ç®¡ç†",-1)),e("div",ue,[e("div",de,[e("div",{class:"avatar-preview",onClick:F},[r.value.avatar?(i(),n("img",{key:0,src:r.value.avatar,alt:"å¤´åƒ"},null,8,ve)):(i(),n("span",me,"+"))]),e("input",{ref_key:"avatarInput",ref:I,type:"file",accept:"image/*",onChange:N,style:{display:"none"}},null,544),s[4]||(s[4]=e("span",{class:"avatar-hint"},"ç‚¹å‡»æ›´æ¢å¤´åƒ",-1))]),e("div",pe,[e("div",ge,[s[5]||(s[5]=e("label",null,"æ˜µç§°",-1)),T(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>r.value.nickname=o),type:"text",placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,512),[[B,r.value.nickname]])]),e("div",he,[s[6]||(s[6]=e("label",null,"é‚®ç®±",-1)),T(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>r.value.email=o),type:"email",placeholder:"è¯·è¾“å…¥é‚®ç®±"},null,512),[[B,r.value.email]])])])]),e("div",fe,[s[7]||(s[7]=e("h3",{class:"section-title"},"å†å²è®°å½•",-1)),_.value.length>0?(i(),n("div",ye,[(i(!0),n(X,null,ee(_.value,o=>{var L,P;return i(),n("div",{key:o.id,class:"history-item",onClick:q=>W(o)},[e("img",{src:o.imageData,alt:"å†å²å›¾ç‰‡",class:"history-thumb"},null,8,ke),e("div",be,[e("span",we,d(((P=(L=o.result)==null?void 0:L.composition)==null?void 0:P.type)||"æœªçŸ¥æ„å›¾"),1),e("span",Ce,d(V(o.timestamp)),1)]),e("button",{class:"delete-btn",onClick:y(q=>Z(o.id),["stop"])},"ğŸ—‘ï¸",8,Ie)],8,_e)}),128))])):(i(),n("div",De,"æš‚æ— å†å²è®°å½•"))]),e("button",{class:"complete-btn",onClick:j,disabled:g.value},d(g.value?"ä¿å­˜ä¸­...":"å®Œæˆ"),9,$e)]),k.value?(i(),n("div",{key:0,class:"detail-modal",onClick:y($,["self"])},[e("div",Me,[e("h3",null,d(((h=(v=(u=a.value)==null?void 0:u.result)==null?void 0:v.composition)==null?void 0:h.type)||"å›¾ç‰‡åˆ†æ"),1),e("p",Re,d(a.value?V(a.value.timestamp):""),1),e("div",Se,[(f=a.value)!=null&&f.imageData?(i(),n("img",{key:0,src:a.value.imageData,alt:"åŸå›¾",onClick:s[2]||(s[2]=o=>M(a.value.imageData)),class:"clickable-image"},null,8,Ue)):p("",!0),(A=a.value)!=null&&A.analysisImage?(i(),n("img",{key:1,src:a.value.analysisImage,alt:"åˆ†æå›¾",onClick:s[3]||(s[3]=o=>M(a.value.analysisImage)),class:"clickable-image"},null,8,Ve)):p("",!0)]),(H=a.value)!=null&&H.result?(i(),n("div",xe,[e("p",null,[s[9]||(s[9]=e("strong",null,"æ„å›¾ï¼š",-1)),C(d(((z=a.value.result.composition)==null?void 0:z.description)||"æ— "),1)]),e("p",null,[s[10]||(s[10]=e("strong",null,"å…‰çº¿ï¼š",-1)),C(d(a.value.result.lighting||"æ— "),1)]),e("p",null,[s[11]||(s[11]=e("strong",null,"è‰²å½©ï¼š",-1)),C(d(a.value.result.color||"æ— "),1)])])):p("",!0),e("button",{onClick:$,class:"close-btn"},"å…³é—­")])])):p("",!0),b.value?(i(),n("div",{key:1,class:"image-viewer-modal",onClick:y(R,["self"])},[e("div",Ae,[e("button",{class:"viewer-close-btn",onClick:R},"Ã—"),e("div",He,[e("button",{onClick:U,disabled:l.value<=.5},"âˆ’",8,ze),e("span",null,d(Math.round(l.value*100))+"%",1),e("button",{onClick:S,disabled:l.value>=3},"+",8,Le),e("button",{onClick:E},"é‡ç½®")]),e("div",Pe,[e("img",{src:w.value,style:se({transform:`scale(${l.value})`}),onWheel:y(G,["prevent"]),draggable:"false"},null,44,Te)])])])):p("",!0)])}}},Ee=J(Be,[["__scopeId","data-v-5482ba5d"]]);export{Ee as default};
